(function($){$.fn.toolbar=function(options){var toolbarId='',DATA_NAME='lib-toolbar',config=options||{};this.each(function(){var toolbar=new lib.Toolbar(config,$(this));toolbarId=toolbar.getId();$(this).data(DATA_NAME+toolbarId,toolbar);});return $(this).data(DATA_NAME+toolbarId);};var lib=lib||{};lib.Toolbar=function(options,container){$.extend(true,this,lib.Toolbar.defaults,options,{'container':container});this.id=this.getId();this._init();};lib.Toolbar.defaults={id:'',items:[],container:$(document.body),handler:$.noop};lib.Toolbar.AUTO_ID=100;lib.Toolbar.HEIGHT='26px';lib.Toolbar.CHILD_WIDTH='120px';lib.Toolbar.prototype={_init:function(){var self=this;var _tbarHtml=[];_tbarHtml.push('<div class="toolbar" id="'+self.id+'">');_tbarHtml.push('  <ul class="toolbar-main-ul"></ul>');_tbarHtml.push('</div>');var _doc=self._doc=$(_tbarHtml.join(''));self._doc.appendTo(self.container);var _toolbar=self._toolbar=$('#'+self.id);self._tbar_main_ul=$('.toolbar-main-ul',_doc);_toolbar.css('height',lib.Toolbar.HEIGHT);self._loadToolbar();self._bindEvent();},_loadToolbar:function(){var self=this;var _items=self.items;if(_items&&$.isArray(_items)&&_items.length>0){for(var i=0,len=_items.length;i<len;i++){var item=_items[i],_li='';if(item==='-'){_li=$('<li class="toolbar-v-seperater">&nbsp;</li>').appendTo(self._tbar_main_ul);continue;}else{_li=$('<li class="toolbar-main-li"></li>').appendTo(self._tbar_main_ul);}self._addItem(item,_li);self._loadChildItems(item.items,_li);}}},_loadChildItems:function(items,currentLi){var self=this,_items=items;if(_items&&$.isArray(_items)&&_items.length>0){var _child_ul=$('<ul class="toolbar-child-ul"></ul>').appendTo(currentLi);_child_ul.addClass('toolbar-child-ul-visibility');if(currentLi.hasClass('toolbar-main-li')){_child_ul.css({'top':(currentLi.outerHeight()+4)+'px','left':'0px'});}else if('toolbar-child-li'){_child_ul.css({'top':'0px','left':(currentLi.outerWidth()+2)+'px'});}for(var i=0,len=_items.length;i<len;i++){var item=_items[i],_li='';if(item==='-'){_li=$('<li class="toolbar-h-seperater">&nbsp;</li>').appendTo(_child_ul);continue;}else{_li=$('<li class="toolbar-child-li"></li>').appendTo(_child_ul);}self._addItem(item,_li);self._loadChildItems(item.items,_li);}}},_addItem:function(item,container){var position={},_btn=null;switch($.type(item)){case'number':case'date':case'string':item=item+'';_btn=container.button({text:item,title:item});break;case'object':if($.isPlainObject(item)&&!$.isEmptyObject(item)){_btn=container.button(item);}break;}if(container.hasClass('toolbar-main-li')){_btn.setPosition({type:'relative',top:'2px'});}else if(container.hasClass('toolbar-child-li')){_btn.setPosition({type:'absolute'});_btn.setWidth(lib.Toolbar.CHILD_WIDTH);}container.css({'width':_btn.getOuterWidth(),'height':_btn.getOuterHeight()});},_bindEvent:function(){var self=this,ul=null;self._tbar_main_ul.find('.toolbar-child-ul').removeClass('toolbar-child-ul-visibility').css('display','none');self._tbar_main_ul.find('.toolbar-main-li,.toolbar-child-li').hover(function(){var _self=$(this),_$child_ul=_self.children('.toolbar-child-ul');window.clearTimeout(_self.data('_time'));$('.toolbar-child-ul:visible',_self.siblings()).hide();if(_$child_ul.length===0){return;}else{if(_$child_ul.is(':hidden')){_$child_ul.show();}}},function(){var _self=$(this),_time=window.setTimeout(function(){$('.toolbar-child-ul',_self).hide();},200);_self.data('_time',_time);});},destroy:function(){this._toolbar.remove();},getOuterHeight:function(){return this._toolbar.outerHeight();},getOuterWidth:function(){return this._toolbar.outerWidth();},getId:function(){return this.id||(this.id='autoId-toolbar-'+(++lib.Toolbar.AUTO_ID));}};})(jQuery);